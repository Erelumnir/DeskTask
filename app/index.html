<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>DeskTask - By CodeLore</title>
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="node_modules/custom-electron-titlebar/lib/renderer/style.css"
    />
  </head>
  <body>
    <div id="app">
      <h1>DeskTask - By CodeLore</h1>
      <div id="tasks"></div>
      <form id="taskForm">
        <input type="text" id="taskInput" placeholder="Enter task..." />
        <select id="prioritySelect">
          <option value="low-priority">Low</option>
          <option value="medium-priority">Medium</option>
          <option value="high-priority">High</option>
        </select>
        <button type="submit">Add Task</button>
      </form>
    </div>

    <script src="node_modules/custom-electron-titlebar/lib/renderer/titlebar.js"></script>
    <script>
      const titlebar = new customTitlebar.Titlebar({
        backgroundColor: customTitlebar.Color.fromHex("#1a1a24"),
        icon: "icon.png",
        menu: null,
        titleHorizontalAlignment: "left",
      });

      const toggleThemeIcon = document.createElement("div");
      toggleThemeIcon.id = "theme-toggle";
      toggleThemeIcon.innerText = "ðŸŒ“";
      toggleThemeIcon.title = "Toggle Dark Mode";
      toggleThemeIcon.style.cursor = "pointer";
      toggleThemeIcon.style.padding = "0 10px";
      toggleThemeIcon.onclick = () => toggleDarkMode();

      titlebar.updateTitle("DeskTask");
      titlebar.container.insertBefore(
        toggleThemeIcon,
        titlebar.container.lastChild
      );

      function toggleDarkMode() {
        document.body.classList.toggle("dark-mode");
        localStorage.setItem(
          "darkMode",
          document.body.classList.contains("dark-mode")
        );
        titlebar.updateBackground(
          customTitlebar.Color.fromHex(
            document.body.classList.contains("dark-mode")
              ? "#1a1a24"
              : "#eeeeee"
          )
        );
      }

      if (localStorage.getItem("darkMode") === "true") {
        document.body.classList.add("dark-mode");
        titlebar.updateBackground(customTitlebar.Color.fromHex("#1a1a24"));
      }

      window.electron.on("tasks", (event, tasks) => {
        const container = document.getElementById("tasks");
        container.innerHTML = "";
        tasks.forEach((task) => {
          const el = document.createElement("div");
          el.className = `task ${task.completed ? "completed" : ""} ${
            task.priority
          }`;
          el.dataset.id = task.id;
          el.innerHTML = `
          <input type="checkbox" ${task.completed ? "checked" : ""}>
          <span class="task-name">${task.name}</span>
          <div class="buttons">
            <button class="edit-button">âœŽ</button>
            <button class="delete-button">ðŸ—‘</button>
          </div>
        `;
          container.appendChild(el);
        });
      });

      document.getElementById("taskForm").addEventListener("submit", (e) => {
        e.preventDefault();
        const name = document.getElementById("taskInput").value.trim();
        const priority = document.getElementById("prioritySelect").value;
        if (name) {
          window.electron.send("add-task", name, priority);
          document.getElementById("taskInput").value = "";
        }
      });

      document.getElementById("tasks").addEventListener("click", (e) => {
        const task = e.target.closest(".task");
        const id = task?.dataset.id;
        if (!id) return;

        if (e.target.classList.contains("edit-button")) {
          const name = task.querySelector(".task-name").textContent;
          const newName = prompt("Edit task:", name);
          if (newName) window.electron.send("edit-task", { id, name: newName });
        }

        if (e.target.classList.contains("delete-button")) {
          window.electron.send("delete-task", id);
        }

        if (e.target.matches('input[type="checkbox"]')) {
          window.electron.send("toggle-task", id);
        }
      });

      document.addEventListener("keydown", (e) => {
        if (e.ctrlKey && e.shiftKey && e.key === "I")
          window.electron.send("open-devtools");
        if (e.ctrlKey && e.key === "n")
          document.getElementById("taskInput").focus();
      });
    </script>
  </body>
</html>
