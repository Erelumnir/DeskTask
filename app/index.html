<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>DeskTask - By CodeLore</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>DeskTask - By CodeLore</h1>
  <div id="tasks"></div>

  <form id="taskForm">
    <input type="text" id="taskInput" placeholder="Enter task...">
    <select id="prioritySelect">
      <option value="low-priority">Low</option>
      <option value="medium-priority">Medium</option>
      <option value="high-priority">High</option>
    </select>
    <button type="submit">Add Task</button>
  </form>

  <button id="darkModeToggle">Toggle Dark Mode</button>

  <script>
    window.electron.on('tasks', (event, tasks) => {
      const container = document.getElementById('tasks');
      container.innerHTML = '';

      tasks.forEach(task => {
        const el = document.createElement('div');
        el.className = `task ${task.completed ? 'completed' : ''} ${task.priority}`;
        el.dataset.id = task.id;
        el.innerHTML = `
          <input type="checkbox" ${task.completed ? 'checked' : ''}>
          <span class="task-name">${task.name}</span>
          <button class="edit-button">Edit</button>
          <button class="delete-button">Delete</button>
        `;
        container.appendChild(el);
      });
    });

    document.getElementById('taskForm').addEventListener('submit', e => {
      e.preventDefault();
      const name = document.getElementById('taskInput').value.trim();
      const priority = document.getElementById('prioritySelect').value;
      if (name) {
        window.electron.send('add-task', name, priority);
        document.getElementById('taskInput').value = '';
      }
    });

    document.getElementById('tasks').addEventListener('click', e => {
      const task = e.target.closest('.task');
      const id = task?.dataset.id;
      if (!id) return;

      if (e.target.matches('.edit-button')) {
        const name = task.querySelector('.task-name').textContent;
        const newName = prompt('Edit task:', name);
        if (newName) window.electron.send('edit-task', { id, name: newName });
      }

      if (e.target.matches('.delete-button')) {
        window.electron.send('delete-task', id);
      }

      if (e.target.matches('input[type="checkbox"]')) {
        window.electron.send('toggle-task', id);
      }
    });

    // Dark mode
    const toggleDark = () => {
      document.body.classList.toggle('dark-mode');
      localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
    };

    document.getElementById('darkModeToggle').addEventListener('click', toggleDark);

    if (localStorage.getItem('darkMode') === 'true') {
      document.body.classList.add('dark-mode');
    }

    document.addEventListener('keydown', e => {
      if (e.ctrlKey && e.key === 'n') document.getElementById('taskInput').focus();
      if (e.ctrlKey && e.key === 'm') toggleDark();
    });
  </script>
</body>
</html>
